; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=aarch64 < %s | FileCheck %s

; Test element at index 0 is zero.
define float @test_v2f32_element_0_zero(<2 x float> %vec) {
; CHECK-LABEL: test_v2f32_element_0_zero:
; CHECK:       // %bb.0: // %entry
; CHECK-NEXT:    // kill: def $d0 killed $d0 def $q0
; CHECK-NEXT:    mov s0, v0.s[1]
; CHECK-NEXT:    ret
entry:
  %with_zero = insertelement <2 x float> %vec, float 0.0, i64 0
  %sum = call nsz float @llvm.aarch64.neon.faddv.f32.v2f32(<2 x float> %with_zero)
  ret float %sum
}

; Test element at index 3 is zero.
define float @test_v4f32_element_3_zero(<4 x float> %vec) {
; CHECK-LABEL: test_v4f32_element_3_zero:
; CHECK:       // %bb.0: // %entry
; CHECK-NEXT:    mov s1, v0.s[2]
; CHECK-NEXT:    faddp s0, v0.2s
; CHECK-NEXT:    fadd s0, s0, s1
; CHECK-NEXT:    fabs s0, s0
; CHECK-NEXT:    ret
entry:
  %with_zero = insertelement <4 x float> %vec, float 0.0, i64 3
  %sum = call float @llvm.aarch64.neon.faddv.f32.v4f32(<4 x float> %with_zero)
  %abs = call float @llvm.fabs.f32(float %sum)
  ret float %abs
}

; Test elements at index 0 and 2 are zero.
define float @test_v4f32_elements_0_2_zero(<4 x float> %vec) {
; CHECK-LABEL: test_v4f32_elements_0_2_zero:
; CHECK:       // %bb.0: // %entry
; CHECK-NEXT:    mov s0, v0.s[3]
; CHECK-NEXT:    fabs s0, s0
; CHECK-NEXT:    ret
entry:
  %zero1 = insertelement <4 x float> %vec, float 0.0, i64 0
  %zero2 = insertelement <4 x float> %zero1, float 0.0, i64 2
  %sum = call float @llvm.aarch64.neon.faddv.f32.v4f32(<4 x float> %zero2)
  %abs = call float @llvm.fabs.f32(float %sum)
  ret float %abs
}

; Test all elements are zero.
define float @test_v4f32_all_zero(<4 x float> %vec) {
; CHECK-LABEL: test_v4f32_all_zero:
; CHECK:       // %bb.0: // %entry
; CHECK-NEXT:    movi d0, #0000000000000000
; CHECK-NEXT:    ret
entry:
  %zero1 = insertelement <4 x float> %vec, float 0.0, i64 0
  %zero2 = insertelement <4 x float> %zero1, float 0.0, i64 1
  %zero3 = insertelement <4 x float> %zero2, float 0.0, i64 2
  %zero4 = insertelement <4 x float> %zero3, float 0.0, i64 3
  %sum = call float @llvm.aarch64.neon.faddv.f32.v4f32(<4 x float> %zero4)
  ret float %sum
}

; Test element at index 0 is zero.
define double @test_v2f64_element_0_zero(<2 x double> %vec) {
; CHECK-LABEL: test_v2f64_element_0_zero:
; CHECK:       // %bb.0: // %entry
; CHECK-NEXT:    mov d0, v0.d[1]
; CHECK-NEXT:    fabs d0, d0
; CHECK-NEXT:    ret
entry:
  %with_zero = insertelement <2 x double> %vec, double 0.0, i64 0
  %sum = call double @llvm.aarch64.neon.faddv.f64.v2f64(<2 x double> %with_zero)
  %abs = call double @llvm.fabs.f64(double %sum)
  ret double %abs
}

declare float @llvm.fabs.f32(float)
declare double @llvm.fabs.f64(double)

declare float @llvm.aarch64.neon.faddv.f32.v2f32(<2 x float>)
declare float @llvm.aarch64.neon.faddv.f32.v4f32(<4 x float>)
declare double @llvm.aarch64.neon.faddv.f64.v2f64(<2 x double>)
